<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Video Analysis Explorer</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/modal.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">
                    <span class="title-icon">üé•</span>
                    Video Analysis Explorer
                </h1>
                <div class="subtitle">Explore 450k+ dashcam videos in 3D space</div>
            </div>
            <div class="header-controls">
                <div class="search-container">
                    <input type="text" id="search-bar" placeholder="Search videos..." />
                    <button id="search-btn" class="icon-btn">üîç</button>
                </div>
                <button id="settings-btn" class="icon-btn" title="Settings">‚öôÔ∏è</button>
                <button id="help-btn" class="icon-btn" title="Help">‚ùì</button>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Control Panel (Left Sidebar) -->
            <aside id="control-panel" class="control-panel">
                <div class="panel-header">
                    <h2>Controls</h2>
                    <button id="toggle-panel" class="toggle-btn">‚óÄ</button>
                </div>
                
                <!-- Search Results Section -->
                <div class="panel-section" id="search-results-section" style="display: none;">
                    <h3>Search Results</h3>
                    <div id="search-results-list" class="results-list"></div>
                    <button id="clear-search" class="btn-secondary">Clear Search</button>
                </div>
                
                <!-- Filters Section -->
                <div class="panel-section">
                    <h3>Filters</h3>
                    <div id="filter-controls">
                        <div class="filter-group">
                            <label for="event-filter">Event Type:</label>
                            <select multiple id="event-filter" class="filter-select">
                                <option value="">Loading...</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="location-filter">Location:</label>
                            <select multiple id="location-filter" class="filter-select">
                                <option value="">Loading...</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="weather-filter">Weather:</label>
                            <select multiple id="weather-filter" class="filter-select">
                                <option value="">Loading...</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="anomaly-slider">Anomaly Threshold:</label>
                            <input type="range" id="anomaly-slider" min="0" max="1" step="0.1" value="0">
                            <span id="anomaly-value">0.0</span>
                        </div>
                        
                        <div class="filter-actions">
                            <button id="apply-filters" class="btn-primary">Apply Filters</button>
                            <button id="clear-filters" class="btn-secondary">Clear All</button>
                        </div>
                    </div>
                </div>
                
                <!-- Clusters Section -->
                <div class="panel-section">
                    <h3>Clusters</h3>
                    <div id="cluster-controls">
                        <div class="cluster-list" id="cluster-list">
                            <div class="loading">Loading clusters...</div>
                        </div>
                        <div class="cluster-actions">
                            <button id="focus-largest-cluster" class="btn-secondary">Focus Largest</button>
                            <button id="clear-cluster-highlights" class="btn-secondary">Clear Highlights</button>
                        </div>
                    </div>
                </div>
                
                <!-- Anomalies Section -->
                <div class="panel-section">
                    <h3>Anomalies</h3>
                    <div id="anomaly-controls">
                        <div class="anomaly-toggle">
                            <label class="switch">
                                <input type="checkbox" id="highlight-anomalies">
                                <span class="slider"></span>
                            </label>
                            <span>Highlight Anomalies</span>
                        </div>
                        <button id="focus-anomalies" class="btn-primary">Focus Top Anomalies</button>
                        <div id="anomaly-list" class="anomaly-list">
                            <div class="loading">Loading anomalies...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Statistics Section -->
                <div class="panel-section">
                    <h3>Statistics</h3>
                    <div id="stats-display">
                        <div class="stat-item">
                            <span class="stat-label">Total Videos:</span>
                            <span class="stat-value" id="total-videos">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Visible:</span>
                            <span class="stat-value" id="visible-videos">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Clusters:</span>
                            <span class="stat-value" id="cluster-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">High Anomalies:</span>
                            <span class="stat-value" id="anomaly-count">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Mini Map -->
                <div class="panel-section">
                    <h3>Navigation</h3>
                    <div class="minimap-container">
                        <canvas id="mini-map" width="200" height="150"></canvas>
                        <div class="minimap-controls">
                            <button id="fit-all-btn" class="btn-secondary">Fit All</button>
                            <button id="reset-camera-btn" class="btn-secondary">Reset View</button>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 3D Visualization Area -->
            <main class="visualization-area">
                <canvas id="three-canvas"></canvas>
                
                <!-- Overlay UI Elements -->
                <div id="hover-tooltip" class="tooltip">
                    <div class="tooltip-content">
                        <div class="tooltip-title"></div>
                        <div class="tooltip-details"></div>
                    </div>
                </div>
                
                <div id="loading-indicator" class="loading-overlay">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading video data...</div>
                </div>
                
                <div id="fps-counter" class="fps-counter">FPS: --</div>
                
                <!-- Navigation Controls -->
                <div class="nav-controls">
                    <button id="zoom-in" class="nav-btn" title="Zoom In">+</button>
                    <button id="zoom-out" class="nav-btn" title="Zoom Out">-</button>
                    <button id="reset-camera" class="nav-btn" title="Reset Camera">üè†</button>
                    <button id="fit-all" class="nav-btn" title="Fit All">üìê</button>
                    <button id="toggle-fullscreen" class="nav-btn" title="Fullscreen">‚õ∂</button>
                </div>
                
                <!-- View Mode Controls -->
                <div class="view-controls">
                    <div class="view-mode-buttons">
                        <button id="clusters-view" class="view-btn active" title="Cluster View">üéØ</button>
                        <button id="anomalies-view" class="view-btn" title="Anomaly View">‚ö†Ô∏è</button>
                        <button id="events-view" class="view-btn" title="Event Type View">üìä</button>
                    </div>
                </div>
                
                <!-- Performance Info -->
                <div class="performance-info">
                    <div id="point-count">Points: 0</div>
                    <div id="render-time">Render: 0ms</div>
                </div>
            </main>
        </div>

        <!-- Detail Modal -->
        <div id="detail-modal" class="modal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title">Video Details</h2>
                    <button id="close-modal" class="close-btn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="video-preview-section">
                        <div id="video-thumbnail" class="video-thumbnail">
                            <img id="thumbnail-image" src="" alt="Video thumbnail">
                            <div class="play-overlay">
                                <button id="play-video-btn" class="play-btn">‚ñ∂Ô∏è</button>
                            </div>
                        </div>
                        <div id="video-player-container" style="display: none;"></div>
                    </div>
                    <div class="video-info-section">
                        <div id="video-details">
                            <div class="detail-loading">Loading video details...</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="view-similar" class="btn-secondary">View Similar Videos</button>
                    <button id="download-video" class="btn-secondary">Download Video</button>
                </div>
            </div>
        </div>
        
        <!-- Video Player Modal -->
        <div id="video-player-modal" class="video-modal">
            <div class="video-player-overlay">
                <div class="video-player-container">
                    <div class="player-header">
                        <h3 id="player-title">Video Player</h3>
                        <button id="close-player" class="close-btn">√ó</button>
                    </div>
                    
                    <div class="video-wrapper">
                        <video id="main-video" preload="metadata" controls>
                            Your browser does not support the video tag.
                        </video>
                        
                        <div class="loading-overlay" id="video-loading">
                            <div class="loading-spinner"></div>
                            <div>Loading video...</div>
                        </div>
                        
                        <div class="error-overlay" id="video-error" style="display: none;">
                            <div>‚ùå Failed to load video</div>
                            <button id="retry-video">Retry</button>
                        </div>
                    </div>
                    
                    <div class="player-info">
                        <div id="video-metadata" class="video-metadata"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="close-btn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h3>Visualization Settings</h3>
                        <div class="setting-item">
                            <label for="point-size">Point Size:</label>
                            <input type="range" id="point-size" min="1" max="10" value="3">
                        </div>
                        <div class="setting-item">
                            <label for="animation-speed">Animation Speed:</label>
                            <input type="range" id="animation-speed" min="0.1" max="2" step="0.1" value="1">
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3>Performance Settings</h3>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="enable-shadows"> Enable Shadows
                            </label>
                        </div>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="show-fps" checked> Show FPS Counter
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="help-modal" class="modal">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Help & Controls</h2>
                    <button class="close-btn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="help-section">
                        <h3>Navigation</h3>
                        <ul>
                            <li><strong>Mouse Drag:</strong> Rotate camera</li>
                            <li><strong>Mouse Wheel:</strong> Zoom in/out</li>
                            <li><strong>Right Click + Drag:</strong> Pan camera</li>
                            <li><strong>Double Click:</strong> Focus on point</li>
                        </ul>
                    </div>
                    <div class="help-section">
                        <h3>Keyboard Shortcuts</h3>
                        <ul>
                            <li><strong>Ctrl+F:</strong> Focus search bar</li>
                            <li><strong>R:</strong> Reset camera</li>
                            <li><strong>F:</strong> Fit all points</li>
                            <li><strong>A:</strong> Focus on anomalies</li>
                            <li><strong>Escape:</strong> Close modals</li>
                        </ul>
                    </div>
                    <div class="help-section">
                        <h3>Features</h3>
                        <ul>
                            <li><strong>Point Size:</strong> Represents anomaly score</li>
                            <li><strong>Point Color:</strong> Represents cluster membership</li>
                            <li><strong>Search:</strong> Semantic search using AI embeddings</li>
                            <li><strong>Filters:</strong> Filter by metadata attributes</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r150/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/examples/js/controls/OrbitControls.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>