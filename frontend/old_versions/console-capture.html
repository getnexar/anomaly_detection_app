<!DOCTYPE html>
<html>
<head>
    <title>Console Capture</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .console-log { margin: 2px 0; padding: 5px; background: #2a2a2a; border-left: 3px solid #4a4a4a; }
        .console-error { background: #3a1a1a; border-left-color: #ff4444; color: #ff8888; }
        .console-warn { background: #3a3a1a; border-left-color: #ffaa44; color: #ffcc88; }
        .console-info { background: #1a2a3a; border-left-color: #4488ff; color: #88bbff; }
        .timestamp { color: #666; margin-right: 10px; }
        #status { padding: 10px; background: #333; margin-bottom: 20px; }
        iframe { width: 100%; height: 400px; border: 1px solid #666; }
    </style>
</head>
<body>
    <h1>Console Output Capture</h1>
    <div id="status">Loading main app in iframe...</div>
    <div id="console-output"></div>
    <h2>App Frame:</h2>
    <iframe id="app-frame" src="/"></iframe>
    
    <script>
        const output = document.getElementById('console-output');
        const status = document.getElementById('status');
        let logCount = 0;
        
        function addLog(type, args, source = 'main') {
            logCount++;
            const div = document.createElement('div');
            div.className = `console-log console-${type}`;
            const time = new Date().toISOString().substr(11, 12);
            div.innerHTML = `<span class="timestamp">[${time}] [${source}]</span> ${args.map(a => {
                if (typeof a === 'object') {
                    try {
                        return JSON.stringify(a, null, 2);
                    } catch (e) {
                        return String(a);
                    }
                }
                return String(a);
            }).join(' ')}`;
            output.appendChild(div);
            
            // Auto-scroll
            div.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Capture iframe console
        const iframe = document.getElementById('app-frame');
        iframe.onload = function() {
            status.textContent = 'Iframe loaded, injecting console capture...';
            
            try {
                const iframeWin = iframe.contentWindow;
                
                // Override console methods in iframe
                const originalConsole = {
                    log: iframeWin.console.log,
                    error: iframeWin.console.error,
                    warn: iframeWin.console.warn,
                    info: iframeWin.console.info
                };
                
                iframeWin.console.log = function(...args) {
                    addLog('log', args, 'iframe');
                    originalConsole.log.apply(iframeWin.console, args);
                };
                
                iframeWin.console.error = function(...args) {
                    addLog('error', args, 'iframe');
                    originalConsole.error.apply(iframeWin.console, args);
                };
                
                iframeWin.console.warn = function(...args) {
                    addLog('warn', args, 'iframe');
                    originalConsole.warn.apply(iframeWin.console, args);
                };
                
                iframeWin.console.info = function(...args) {
                    addLog('info', args, 'iframe');
                    originalConsole.info.apply(iframeWin.console, args);
                };
                
                // Capture errors
                iframeWin.addEventListener('error', (event) => {
                    addLog('error', [`JS Error: ${event.message} at ${event.filename}:${event.lineno}:${event.colno}`], 'iframe');
                });
                
                iframeWin.addEventListener('unhandledrejection', (event) => {
                    addLog('error', [`Unhandled Promise Rejection: ${event.reason}`], 'iframe');
                });
                
                status.textContent = `Console capture active. Captured ${logCount} logs.`;
                
                // Check loading status
                setTimeout(() => {
                    const loadingEl = iframeWin.document.querySelector('.loading-text');
                    if (loadingEl && loadingEl.textContent.includes('Loading video data')) {
                        addLog('error', ['STILL STUCK ON LOADING AFTER 5 SECONDS!'], 'checker');
                        
                        // Try to manually trigger initialization
                        addLog('warn', ['Attempting manual initialization...'], 'checker');
                        if (iframeWin.VideoAnalysisApp) {
                            addLog('info', ['VideoAnalysisApp class found, creating instance...'], 'checker');
                            iframeWin.videoAnalysisApp = new iframeWin.VideoAnalysisApp();
                        } else {
                            addLog('error', ['VideoAnalysisApp class NOT FOUND!'], 'checker');
                        }
                    }
                }, 5000);
                
            } catch (e) {
                addLog('error', [`Failed to capture iframe console: ${e.message}`], 'main');
            }
        };
        
        // Also capture this window's console
        const originalMainConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };
        
        console.log = function(...args) {
            addLog('log', args, 'main');
            originalMainConsole.log.apply(console, args);
        };
        
        console.error = function(...args) {
            addLog('error', args, 'main');
            originalMainConsole.error.apply(console, args);
        };
        
        console.warn = function(...args) {
            addLog('warn', args, 'main');
            originalMainConsole.warn.apply(console, args);
        };
    </script>
</body>
</html>