<!DOCTYPE html>
<html>
<head>
    <title>Test Fully Fixed Version</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .test { margin: 10px 0; padding: 10px; background: #2a2a2a; border-radius: 4px; }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #F44336; }
        iframe { width: 100%; height: 600px; border: 2px solid #444; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Testing Fully Fixed Version</h1>
    <div id="results"></div>
    <iframe id="app-frame" src="/index-fully-fixed.html"></iframe>
    
    <script>
        const results = document.getElementById('results');
        const iframe = document.getElementById('app-frame');
        
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = 'test ' + (type === 'success' ? 'success' : type === 'error' ? 'error' : '');
            div.textContent = msg;
            results.appendChild(div);
            console.log(msg);
        }
        
        // Wait for iframe to load
        iframe.onload = function() {
            setTimeout(() => {
                try {
                    const win = iframe.contentWindow;
                    
                    // Test 1: Three.js loaded
                    if (win.THREE) {
                        log('✅ THREE.js is loaded', 'success');
                        log(`Version: ${win.THREE.REVISION}`);
                    } else {
                        log('❌ THREE.js NOT found', 'error');
                    }
                    
                    // Test 2: OrbitControls loaded
                    if (win.THREE && win.THREE.OrbitControls) {
                        log('✅ OrbitControls is loaded', 'success');
                    } else {
                        log('❌ OrbitControls NOT found', 'error');
                    }
                    
                    // Test 3: App instance
                    if (win.videoAnalysisApp) {
                        log('✅ App instance exists', 'success');
                    } else {
                        log('❌ App instance NOT found', 'error');
                    }
                    
                    // Test 4: Loading screen
                    const loader = win.document.getElementById('loading-indicator');
                    if (loader) {
                        const isHidden = loader.style.display === 'none';
                        if (isHidden) {
                            log('✅ Loading screen is hidden', 'success');
                        } else {
                            log('❌ Loading screen is still visible', 'error');
                        }
                    }
                    
                    // Test 5: Canvas
                    const canvas = win.document.querySelector('canvas');
                    if (canvas) {
                        log('✅ Canvas element found', 'success');
                        log(`Canvas size: ${canvas.width}x${canvas.height}`);
                    } else {
                        log('❌ Canvas NOT found', 'error');
                    }
                    
                } catch (e) {
                    log('❌ Error: ' + e.message, 'error');
                }
            }, 3000);
        };
    </script>
</body>
</html>